<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="admin/layout">

<head>
    <style>
        .plugin-nav {
            height: 26px;
            width: 95%;
            border-bottom: 1px solid #cccccc;
            margin:20px;
            margin-top:50px;
        }

        .move{
            height: 4px;
            width: 80px;
            border-top: 4px solid #573173;/*只需要将上边显示出来*/
            position: absolute;
            left: 0;
            top: 22px;
            transition: left .2s ease-in-out 0s;/*包含四个过度属性：执行变换属性、执行时间、速率、延迟*/
            -webkit-transition: left .2s ease-in-out 0s;/*chrome和safari*/
            -moz-transition: left .2s ease-in-out 0s;/*firefox*/
            -o-transition: left .2s ease-in-out 0s;/*opera*/
        }
        .plugin-nav ul {
            list-style-type: none;
            padding: 0px;
            float: left;
            position: relative;/*子元素absol*/
        }

        .plugin-nav  ul li {
            width: 80px;
            height: 26px;
            text-align: center;
            float: left;
        }
        .plugin-nav  ul li a {
            color: #848789;
            text-decoration: none;
            line-height: 26px;
        }
        .plugin-nav   ul a:hover{
            color: #573173;
        }

        .plugin-list{
            border: 1px solid #cccccc;
            width: 40%;
            /* height: 100px; */
            float: left;
            display: inline;
            padding: 10px;
            margin: 10px;
            margin-left:20px;
            height: 120px;
            border-radius: 4px;
        }
        .plugin-pic {
            float: left;
        }
        .plugin-text{
            width: 65%;
            float: left;
            padding-left: 10px;
        }
        .plugin-name{
            display: block;
            font-size: 16px;
            color: #007bff;
        }
        .plugin-description{
            display: block;
            padding-top: 10px;
        }
        .plugin-from{
            display: block;
            padding-top: 10px;}
        .plugin-btn{float: right}

    </style>
</head>

<div layout:fragment="content" >
    <!-- content-->

    <div class="">
        <div id="app-body"   class="bf-body">

            <h3 class="page-title">插件管理</h3>
            <button type="button"   class="btn btn-outline-primary btn-sm"  style="float: left; margin-left:150px;margin-top:-38px;height: 30px;line-height: 30px" >上传插件</button>

            <div class="plugin-nav">
                <ul>
                    <li>我的插件</li>
                    <li>推荐插件</li>
                    <li class="move"></li>
                </ul>
            </div>
            <!-- Grid -->


            <div  aria-label="posts">
                <div  class="plugin-list" >
                    <div class="plugin-pic"><img src="http://webtap.cn/upload/logo/photoshop.png"></div>
                    <div class="plugin-text">
                        <a class="plugin-name">插件名称</a>
                        <span class="plugin-description">插件描述</span>
                        <span class="plugin-from">来自 <a href="#">作者</a></span>
                    </div>
                   <div class="plugin-btn"><button class="btn btn-outline-primary btn-sm " style="height: 30px;line-height: 30px">启用</button></div>
                    <div style="clear: both"></div>
                </div>

                <div  class="plugin-list" >
                    图片2
                </div>


            </div>

            <!--/Grid -->

            <!-- Modal Category -->
            <div th:replace="admin/fragment/categoryMd::catFragment"></div>

        </div>
    </div>

    <!-- fragment begin-->
    <div th:replace="admin/fragment/files :: filesFragment"></div>
    <!-- fragment end-->

</div>



<th:block layout:fragment = "bodyAssets">

    <script>
        Vue.use(window.vuelidate.default);

        const app = new Vue({
            el: '#app-body',
            id:0,
            data: {
                category:{editType:"新增"},
                categories:{},
                appdata:{}
            },

            methods: {
                load: function () {

                    axios.get(webRoot + 'api/app/categories')
                        .then(response => {
                        this.categories = response.data;
                }).catch(function (error) { toastr.error(error); });

                    if(this.id>0){
                        axios.get(webRoot + 'api/app/'+this.id)
                            .then(response => {
                            this.appdata = response.data;
                        $("#app-logoUrl").val(this.appdata.logoUrl);
                    }).catch(function (error) { toastr.error(error); });
                    }else {
                        this.appdata.viewPermission =2;
                    }
                },
                save: function () {
                    var posturl =webRoot + 'api/apps/save' ;

                    var logoUrl =  $("#app-logoUrl").val();
                    if(logoUrl!=""){
                        if(logoUrl.indexOf('/')>0&&logoUrl.indexOf("http")<0){
                            logoUrl =  webRoot + $("#app-logoUrl").val();
                        }
                    }
                    this.appdata.logoUrl = logoUrl;
                    var app = this.appdata;
                    app.passwordRequired = app.passwordRequired?"1":"0";
                    axios.post(posturl, app)
                        .then(function (response) {
                            if(response.data.rspCode!="000000"){
                                toastr.error(response.data.rspCode+" "+response.data.rspMsg);
                            }else {
                                toastr.success(response.data.rspMsg);
                                setTimeout(function () { location.href = webRoot +"admin/app/list"; }, 1000);
                            }
                        })
                        .catch(function (error) {
                            toastr.error(error);
                        });
                },
                saveCategory:function(){
                    var posturl =webRoot + 'api/category/save' ;
                    var cat = this.category;
                    axios.post(posturl, cat)
                        .then(function (response) {
                            var _cat = response.data;
                            app.$data.categories.push(_cat);
                            app.$data.appdata.categoryId = _cat.id;
                            $("#modal-category").modal("hide");
                        })
                        .catch(function (error) {
                            toastr.error(error);
                        });
                },
                addCat:function(){
                    this.category = {editType:"新增"};
                    $("#modal-category").modal();
                },
                openFile:function () {
                    fileManagerController.open(insertAppLogoCallback);
                }
            },
            beforeMount() {
                if (fromQueryString('id')) {
                    this.id = fromQueryString('id');
                }
                this.load();
            }
        })


    </script>


    <script src="/admin/js/app/fileManagerController.js"></script>
</th:block>
